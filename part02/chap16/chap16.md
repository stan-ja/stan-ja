## 16. 方向、回転、超球面

方向統計には、方向という制約のあるデータあるいはパラメータ、もしくはその両方があります。方向を組み合わせると球面となり、そのジオメトリは、ユークリッド空間のジオメトリに滑らかに（**訳:「ゆがみなく」がよい?**）マッピングすることができません。1周まわって元に戻るということも可能だからです。平面の紙の上に地図を作るのに、地球上の互いに近い場所ならどこでも互いに近いところにあるとはできないのもこういう理由によるものです。この根本的な問題は2次元では容易に可視化できます。円周に沿って移動していると、初めの場所に戻ってしまいます。言い換えると、0度と360度は（0と$2\pi$ラジアンでも同じことですが）同じ点を指しますし、359度と2度との間の距離は137度と140度との距離と同じです。

Stanには単位ベクトルのデータ型があり、方向統計に対応しています。単位ベクトルの値は、超球面（2次元では円周、3次元では球面）上の点を決定します。

### 16.1. 単位ベクトル

ベクトル$x \in \mathbb{R}^K$の長さは次式で与えられます。

![$$ \|x\| = \sqrt{x^{\top} x} = \sqrt{x_1^2 + x_2^2 + \cdots + x_k^2} $$](fig/fig01.png)

単位ベクトルは、単位長（すなわち長さ1）を持つベクトルと定義されます。

以下のように変数宣言します。

```
unit_vector[k] x;
```

`x`の値は、サイズ`K`で単位長を持つベクトルに制約されます。58.7節に、Stanのアルゴリズムで使っている、単位ベクトルに制約されているパラメータを制約のない空間に変換する方法の詳細があります。

### 16.2. 円、球面、超球面

$n$次球面を$S^n$と書くことにしますが、これは$(n+1)$次元の単位ベクトルの組で定義されます。

![$$ S^n = \{x \in \mathbb{R}^{n+1} : \|x\| = 1\} $$](fig/fig02.png)

$S^n$は、$(n+1)$次元の点で作られるにもかかわらず、$n$次元の多様体でしかありません。例えば、$S^2$は$\mathbb{R}^3$の点の組で定義されますが、そうした点は緯度・経度により一意に記述することができます。幾何学的には、$\mathbb{R}^3$の$S^2$で定義される表面は、局所的には平面つまり$\mathbb{R}^2$に似ています。しかし、$S^2$の全体的な形は、コンパクト（すなわち、点間に最大距離が存在する）というところで平面とは違っています。地球を「直線」（すなわち測地線）に沿って回り始めると、最終的には初めの場所に戻ってしまいます。球面($S^2$)の測地線が「大円」と呼ばれるのはこれが理由です。そしてまた、円周あるいは球面統計には何らかの上手な表現が必要となる理由でもあります。

$S^{n-1}$が局所的には$\mathbb{R}^{n-1}$に似ているとしても、両者を平らに（**訳:「ゆがみなく」がよい?**）マッピングする方法はありません。例えば、緯度と経度は、（自然単位では$2\pi$で一回りする）測定基準に基づいていますので、平らな（**訳:「ゆがみない」がよい?**）地図は作れません。

上下限のある区間$(a,b)$のように、幾何学的には、あらゆる2点間の距離には上限があるので球面はコンパクトです。

### 16.3. 制約のないパラメータへの変換

Stanは、Marsaglia (1972)の方法で補助変数を使い、$\mathbb{R}^{K+1}$における任意の点を$S^K$の点へと（逆）変換します。点$y \in \mathbb{R}^K$は、点$x \in S^{K-1}$に以下のように変換されます。

![$$ x = \frac{y}{\sqrt{y^{\top} y}} $$](fig/fig03.png)

このマッピングの問題は、多対1であることです。原点から出ている あるベクトル上の点はすべて、球面上の同じ点に投影されます。Marsaglia (1972)は、必要な一様性を提供する(**provides the desired properties of uniformity の訳?**)、このマッピングの補助変数の解釈を紹介しました。詳細は58.7節を参照してください。

##### 警告: ゼロでは未定義

上の$\mathbb{R}^n$から$S^n$へのマッピングはゼロでは定義されません。サンプリング中はこの点の結果は測度ゼロであり、そのため無視されるかもしれません。一方、この点はデフォルトの初期化点なので、単位ベクトルのパラメータはゼロで初期化できません。（**よく分かりませんでした**）単純な回避法は、ゼロに近い非常に狭い区間で初期化することです。これはStanのインターフェイスすべてに組み込まれているオプションです。

### 16.4. 単位ベクトルと回転

単位ベクトルはそのまま角度に対応していますから、回転にも対応します。これは2次元で見るとわかりやすいでしょう。円周上のある点は、角度$\theta$としても等価なコンパス上の方角を決定します。ある角度$\theta$を与えると、左からの掛け算で角度$\theta$だけ回転させるような行列を定義できます。（2次元の）角度$\theta$については、$2 \times 2$回転行列は以下のように定義されます。

![$$ R_{\theta} = \left[\begin{array}{cc} \cos\theta & -\sin\theta \\ \sin\theta & \cos\theta \end{array}\right] $$](fig/fig04.png)

2次元ベクトル$x$が与えられると、$R_\theta x$は$x$を（原点のまわりで）$\theta$度だけ回転させます。

### 16.5. 日と年の円周表現

24時間時計は、深夜0時から正午を経て、1回転して再び0時に戻るという、1日の時間の進み方を自然に表しています。したがって、円周上を24時間に分割した点は、1日の時刻を自然に表したものです。同様に、1年は季節をめぐって、また元の季節に戻ります。

人為的なものには慣習による時間効果がよく見られます。こうしたものも、休日や週末を示すアドホックな予測変数によって、あるいは、夏時間を自然のスケールに戻すよう正規化するといったことによって、直接モデリングできます。
